<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content=
"text/html; charset=iso-8859-15">
<title>OnlineDict 选项页</title>
<link rel="stylesheet" type="text/css" href="options.css">
</head>
<body>
<div id="main_container">
<table width="100%" valign="top"><tr><td>
<h1><img src="logo.png" width="30" />OnlineDict 单词记忆助手</h1>
</td>
<td align="right">
<p><a href="./options.htm" target="_blank">选项</a> | <a href="http://code.google.com/p/onlinedict/" target="_blank">OnlineDict主页</a></p>
</td>
</tr></table>

<table cellpadding="5" class="settings-table">
<tr><td valign="top" width="75%">


<table width="100%"><tr><td>
您最近查看的生词：
</td><td align="right">
<input type="button" value="上一页" onclick="ShowPrev()"/><input type="button" value="下一页"  onclick="ShowNext()"/>
</td><td align="left">
<div id="itemcount" align="left">共N条</div>
</td></tr></table>

<div id="div_words" ></div>
</td>
<td valign="top">
您最近记住了以下单词：
<div id="div_finished"></div>
</td>
</tr>
</table>
<script type="text/javascript" src="lookup.js"></script>
<script type="text/javascript" src="newwords.js"></script>
<script> 
var range = DBGetRange();
var currentpage = GetPageCount();
ShowPage(currentpage);
ShowRememberItems();

function GetPageCount()
{
    var itemcount = range["itemCount"];
    if(itemcount<=0)
    {
        return 0;
    }
    var flr = Math.floor(itemcount/7);
    if(0==itemcount%7)
    {
        flr -= 1;
    }
    return flr;
}

function SetRemember(id)
{
  DBSetRemember(id);
  FIFOAddItem([id,DBGetItem(id)]);
  
  var div = document.getElementById("div_newword_" + id);//.style.display = "none";
  div.style.background = '#afa';
  div.innerHTML = "<img src='tick.png'/>" + (id+1) + ". "+ DBGetItem(id)[1];
  
  ShowRememberItems();
}

//当单词图层点击时
//转换折叠状态并显示
function OnWordDivClick()
{
    var item = DBGetItem(this.item_id);
    if(!item)
    {
        return;
    }
    
    //标题栏
    var htmlStr = "";
    if(item[3]==1) //已记住
    {
        htmlStr += "<img src='tick.png'/>" ;
        htmlStr += (this.item_id+1) + ". " + item[1];
        this.innerHTML= htmlStr;
    }
    else            //未记住
    {
        this.innerHTML= "<table width='100%'><tr><td>" + (this.item_id+1) + ". <bold>"+ item[1] 
        + "</bold></td><td align='right'>" 
        + "<input type='button' value='记住了' onclick='jscript:SetRemember("+  this.item_id + ");'/>"
        + "</td></tr></table>";
    }
    
    //取词历史栏
    if(this.fold) //折叠
    {
        this.fold = false;
        this.style.background = '#cfc';
        
        var reg = new RegExp(item[1],"gim");
        var divExp = document.createElement("div");
        divExp.style.background = '#DFD';
        if(!item[2])
        {
            item[2] = "(empty)";
        }
        var newWord = "<bold><font color=red>" + item[1] + "</font></bold>";
        divExp.innerHTML = "取词记录：" + item[2].replace(reg,newWord);
        this.appendChild(divExp);
    }
    else    //非折叠
    {
        this.fold = true;
        this.style.background = '#afa';
    }
}

function OnRememberWordDivClick()
{
    ShowItems(this.item_id,1);
    var div = document.getElementById("div_newword_" + this.item_id);
    if(div)
    {
        div.onclick();
    }
}
function AddRememberItem(id,item)
{
    var div = document.createElement("div");
    div.style.background = '#cfc';
    div.item_id = id;
    div.onclick = OnRememberWordDivClick;
    div.innerHTML= "<img src='tick.png'/>" + item[1];
    document.getElementById("div_finished").appendChild(div);
}
function ShowRememberItems()
{
    var maxRememberCount = 15;
    var itemLen = FIFOLength();
    document.getElementById("div_finished").innerHTML = "";
    if(itemLen<=0)
    {
        document.getElementById("div_finished").innerHTML = "还没有记住的单词，要努力啊！";
    }
    
    for(var i=itemLen-1;i>=0;i--)
    {
        maxRememberCount--;
        if(maxRememberCount<=0)
        {
            break;
        }
        var fi_item = FIFOItem(i);
        AddRememberItem(fi_item[0],fi_item[1]);
    }
}
function ShowItems(idBgn,count)
{
    var wordHtm = "";
    document.getElementById("div_words").innerHTML = "";
    for(var i=idBgn+count-1;i>=idBgn;i--)
    {
      if(range["itemCount"] <= i)
      {
        continue;
      }
      var item = DBGetItem(i);
      if(!item)
      {
        continue;
      }
      var div = document.createElement("div");
      div.item_id = i;
      div.onclick = OnWordDivClick;
      div.id = "div_newword_" + i;

      if(item[3]==0)
      {
        div.fold = true;
      }
      else if(item[3]==1)
      {
        div.fold = false;
      }
      else
      {
        alert("Something wrong:item[3]=" + item[3]);
      }
      document.getElementById("div_words").appendChild(div);
      
      div.onclick(); //初始显示
    }
}


function ShowPage(i)
{
    document.getElementById("itemcount").innerHTML = (GetPageCount()+1) + "页之" + (i+1);
    ShowItems(i*7,7);
}
function ShowPrev()
{
    currentpage--;
    if(currentpage<=0)
    {
        currentpage = 0;
    }
    ShowPage(currentpage);
}
function ShowNext()
{
    currentpage++;
    if(currentpage>=GetPageCount())
    {
        currentpage = GetPageCount();
    }
    ShowPage(currentpage);
}
</script>

</body>
</html>